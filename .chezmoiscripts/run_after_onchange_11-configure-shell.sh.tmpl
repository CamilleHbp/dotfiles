#!/bin/sh

# ---------------------------------------------------------------------------- #
#                          Unofficial Bash Strict Mode                         #
# ---------------------------------------------------------------------------- #
# See http://redsymbol.net/articles/unofficial-bash-strict-mode/
# -e: exit on error
# -u: exit on unset variables
# -o pipefail: prevents errors in a pipeline from being masked 
set -euo pipefail
# IFS (Internal Field Separator): controls what Bash calls word splitting.
# When set to a string, each character in the string is considered by Bash to separate words
IFS=$'\n\t'

# ---------------------------------------------------------------------------- #
#                               Zsh configuration                              #
# ---------------------------------------------------------------------------- #
# Set Homebrew's zsh as the default. Homebrew's folder is different depending on the architecture (M1 vs Intel)
# TODO: find a way to prompt to enter a custom folder since promptString is only available in .chezmoi.toml.tmpl
# $email := promptString "Input your custom homebrew bin folder or leave empty to use the default bin folder"
# if $email | trim
    # sudo chsh -s $email `whoami`
{{ if eq .chezmoi.arch "arm64" -}}
    sudo chsh -s /opt/homebrew/bin/zsh `whoami`
{{ else -}}
    sudo chsh -s /usr/local/bin/zsh `whoami`
{{ end -}}

# Install FZF's useful key bindings and fuzzy completion
{{ if eq .chezmoi.os "darwin" -}}
    $(brew --prefix)/opt/fzf/install --key-bindings --completion --no-update-rc --no-bash --no-fish
{{ else if eq .chezmoi.os "linux" -}}
    # TODO: install fzf on linux
{{ end -}}
